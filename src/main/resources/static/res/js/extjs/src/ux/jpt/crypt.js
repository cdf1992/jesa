function setDeviceParam(r){0!=CryptCtrl.IsDeviceOpened()&&CryptCtrl.CloseDevice(),CryptCtrl.strContainer="",userPasswd=r}function openDevice(r){return setDeviceParam(r),0!=CryptCtrl.IsDeviceOpened()&&CryptCtrl.CloseDevice(),CryptCtrl.OpenDeviceEx(userPasswd),87==CryptCtrl.ErrCode&&CryptCtrl.OpenDeviceEx(userPasswd),0!=CryptCtrl.ErrCode&&CryptCtrl.ErrCode!=-1?(jAlert("<div id='popup_message'>"+CryptCtrl.ErrMsg+"</div>","提示"),CryptCtrl.ErrCode):(devicePort=CryptCtrl.strContainer,CryptCtrl.ErrCode)}function changePin(){if(0==openDevice())return CryptCtrl.ChangePinEx(),jAlert("<div id='popup_message'>"+CryptCtrl.ErrMsg+"</div>","提示"),CryptCtrl.ErrCode}function signData(r,e,t){var C=0;if(C=openDevice(),0!=C)return"";if(CryptCtrl.SignData(r,r.length,"SHA1withRSA",e,t),0!=CryptCtrl.ErrCode)return jAlert("<div id='popup_message'>"+CryptCtrl.ErrMsg+"</div>","提示"),"";var s=CryptCtrl.strResult;return s}var serverPacket="",clientAuthCode="",serverRandom="",operType="",userId="",userPasswd="",deviceType="",devicePort="",userName="",clientPubKey="",sysName="",sysCode="",userAccount="",userPin="",strContainer="",strProvider="",nProvType=1;